#!/usr/bin/env -S bash -e

destdir=~/.suckless
builddir=~/.suckless-build/st

if [[ $(basename "$1") != config.h ]];then
  echo "Usage: st-rebuild </path/to/config.h>"
  exit 1
fi

mkdir -p $(dirname "$builddir")
rm -rf "$builddir"
cp -r /usr/src/st "$builddir"
cp -f "$1" "$builddir"

{
  cd "$builddir"
  make
  make PREFIX="$destdir" install
} &> /dev/null

echo "Done! Recommend to add '~/.suckless/bin' to \$PATH to use new builded st."
